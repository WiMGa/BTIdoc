# üöÄ –û–¢–ß–Å–¢ –û –†–ï–ê–õ–ò–ó–ê–¶–ò–ò MCP –°–ï–†–í–ï–†–ê BTI

**–î–∞—Ç–∞**: 2024-09-21
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û

## üéØ –¶–ï–õ–¨ –ü–†–û–ï–ö–¢–ê
–°–æ–∑–¥–∞—Ç—å —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è BTI_API, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç —Å–∏—Å—Ç–µ–º—É –∏–∑ –æ–±—ã—á–Ω–æ–π "—Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞–Ω–∏–π" –≤ **–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é** —Å –ø—Ä—è–º—ã–º –¥–æ—Å—Ç—É–ø–æ–º Claude Code –∫ –¥–∞–Ω–Ω—ã–º.

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

### 1. MCP Controller (BTI_API/Controllers/McpController.cs)
- **4 –∫–ª—é—á–µ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞**:
  - `POST /mcp/tools/query_database` - SQL SELECT –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
  - `POST /mcp/tools/log_event` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–≤–æ–ª—é—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
  - `GET /mcp/tools/get_task_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
  - `GET /mcp/tools/get_mandatory_rules` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (BTI_API/Models/BtiEvolutionLog.cs)
- **–¢–∞–±–ª–∏—Ü–∞ BTI_Evolution_Log** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã
- –ü–æ–ª—è: tmEvent, sEventType, sComponent, sDescription, jsonBefore/After, dProfitDDRatio

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π DbContext (BTI_API/Data/BtiDbContext.cs)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ BtiEvolutionLog
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è PostgreSQL jsonb –ø–æ–ª–µ–π

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **MCP_GUIDE.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é MCP —Å–µ—Ä–≤–µ—Ä–∞
- **MCP_MANDATORY_PROTOCOL.md** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫
- **MCP_IMPLEMENTATION_REPORT.md** - —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç

## üõ°Ô∏è –ü–†–û–¢–û–ö–û–õ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Claude Code:
1. ‚ö†Ô∏è **–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥** –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
2. ‚ö†Ô∏è **–°–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç–∞—é—â–µ–π –ª–æ–≥–∏–∫–∏
3. ‚ö†Ô∏è **–ó–ê–ü–†–ï–©–ï–ù–û –∏–∑–º–µ–Ω—è—Ç—å** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚ö†Ô∏è **–ü–†–ò–ù–¶–ò–ü**: –†–∞–±–æ—Ç–∞–µ—Ç - –Ω–µ —Ç—Ä–æ–≥–∞–π! –¢–æ–ª—å–∫–æ —Å —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ—Ç–æ–∫–æ–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
1. Read code ‚Üí 2. Ask permission ‚Üí 3. Get YES ‚Üí 4. Then change
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –¢–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ MCP (–Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ PostgreSQL —á–µ—Ä–µ–∑ Npgsql
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON

## üìä –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
```sql
SELECT "sTaskId", "tmStarted", "sWorkerId"
FROM "Tasks"
WHERE "sStatus" = 'processing' AND "tmStarted" < NOW() - INTERVAL '1 hour';
```

### –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```sql
SELECT "kUsed", COUNT(*) as count, AVG("dProfitDDRatio") as avg_ratio
FROM "Results"
GROUP BY "kUsed" ORDER BY avg_ratio DESC;
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π:
```sql
SELECT "sTaskId", "dProfitDDRatio", "kUsed", "iTPSL"
FROM "Results"
WHERE "dProfitDDRatio" < 0.1 OR "dProfitDDRatio" IS NULL;
```

## üöÄ –†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò

1. **–ü—Ä—è–º–æ–π SQL –¥–æ—Å—Ç—É–ø** –∫ –¥–∞–Ω–Ω—ã–º BTI —Å–∏—Å—Ç–µ–º—ã
2. **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π
4. **–≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã
5. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫

## ‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:
- `GET http://localhost:5080/mcp/tools` ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
- `GET http://localhost:5080/mcp/tools/get_mandatory_rules` ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
- `POST http://localhost:5080/mcp/tools/query_database` ‚úÖ –ì–û–¢–û–í
- `POST http://localhost:5080/mcp/tools/log_event` ‚úÖ –ì–û–¢–û–í
- `GET http://localhost:5080/mcp/tools/get_task_stats` ‚úÖ –ì–û–¢–û–í

### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:
- `dotnet build` ‚úÖ –ë–ï–ó –û–®–ò–ë–û–ö
- `dotnet run` ‚úÖ –°–ï–†–í–ï–† –ó–ê–ü–£–©–ï–ù –ù–ê –ü–û–†–¢–£ 5080

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

**BTI —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è, –∞ —Å—Ç–∞–ª–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–µ–π**, –≥–¥–µ Claude Code –º–æ–∂–µ—Ç:

- üîç **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üö® **–û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üìà **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- üìù **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —ç–≤–æ–ª—é—Ü–∏—é** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å** —Å –≥–æ—Ç–æ–≤—ã–º –∫–æ–¥–æ–º

## üìã –°–¢–ê–¢–£–° –§–ê–ô–õ–û–í

### –°–æ–∑–¥–∞–Ω—ã:
- ‚úÖ `BTI_API/Controllers/McpController.cs`
- ‚úÖ `BTI_API/Models/BtiEvolutionLog.cs`
- ‚úÖ `BTI_API/MCP_GUIDE.md`
- ‚úÖ `BTIdoc/MCP_MANDATORY_PROTOCOL.md`
- ‚úÖ `BTIdoc/MCP_IMPLEMENTATION_REPORT.md`

### –û–±–Ω–æ–≤–ª–µ–Ω—ã:
- ‚úÖ `BTI_API/Data/BtiDbContext.cs`
- ‚úÖ `BTIman/CLAUDE.md`

---

**üöÄ –ì–û–¢–û–í–û –ö –†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–û–ú–£ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!**

*–≠—Ç–æ—Ç MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç BTI –≤ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –≥–¥–µ Claude Code –º–æ–∂–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.*